<!-- templates/mypage.html -->
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ë§ˆì´í˜ì´ì§€</title>
</head>
<body>
<h2>ë§ˆì´í˜ì´ì§€</h2>
<div id="userInfo">ë¡œë”© ì¤‘...</div>

<!-- ğŸ“Œ ê²Œì‹œíŒ ì—°ê²° ë²„íŠ¼ -->
<br><br>
<button onclick="goToWritePage()">ê¸€ì“°ê¸°</button>
<button onclick="goToPostList()">ê²Œì‹œê¸€ ëª©ë¡</button>

<br><br>
<button onclick="logout()">ë¡œê·¸ì•„ì›ƒ</button>

<script>
    const token = localStorage.getItem("jwt");
    if (!token) {
        alert("ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.");
        window.location.href = "/login";
    }

    async function fetchUserInfo() {
        const response = await fetch('/api/user/info', {
            method: 'GET',
            headers: {
                'Authorization': 'Bearer ' + token
            }
        });

        if (response.ok) {
            const user = await response.json();
            document.getElementById("userInfo").innerText =
                `ì•„ì´ë””: ${user.username}`;
        } else {
            alert("ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.");
            window.location.href = "/login";
        }
    }

    function logout() {
        fetch('/api/user/logout', {
            method: 'POST',
            headers: { 'Authorization': 'Bearer ' + token }
        }).then(() => {
            localStorage.removeItem("jwt");
            alert("ë¡œê·¸ì•„ì›ƒ ì™„ë£Œ");
            window.location.href = "/";
        });
    }

    function goToWritePage() {
        window.location.href = "/posts/write";  // ê¸€ì“°ê¸° í˜ì´ì§€
    }

    function goToPostList() {
        window.location.href = "/posts"; // ê²Œì‹œê¸€ ëª©ë¡
    }

    fetchUserInfo();
</script>
</body>
</html>
